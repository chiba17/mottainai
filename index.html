<html lang="ja"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6IjJkYmE3M2IxMjU1ZjVkYjU2ZDZhODNhYmE5YTA2Zjg5YzAwMDI1ZDciLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwMzY4NzEzMTEyNjQyNDMzNzAyMyIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjX2JkZDNkNWMzM2Y2N2MxNjVfaW5kZXguaHRtbC04MTcifSwiZXhwIjoxNzY2Mzk2NDY4LCJpYXQiOjE3NjYzOTI4NjgsImFsZyI6IlJTMjU2In0.qXGDO2VTdDssx3eRkAgedloPMksv5tsGG6yXxs0fOYU6hxiS8vL1vHqzPAZMnNkNC7a4zmHfscB1dRW8XAUnqRgPhig079e90b51Nh9g7sLCdh4NGid2DOovFkYAoWoblgygIBaIhhwETWe0FOSSk-3uWXd75SRxmHDDkoYpX0480zBbej14DBThYuw2AiuCOHDPsiDYaZmyBoLNlYohCH8Bz_oQ0JULoKmhLYuCfCrrL_JqCGhfQQuAQR8VqImKjqb7BhVvjGbwAeIXiNK8yEMgrXQOwd8dZpLp_5laGgxlG9LoDDg7nThDECabQ_x7Skrlyfo6xGLgX8wibgEg8A","c_bdd3d5c33f67c165_index.html-817")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageTransformModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","imageTransformModelName":"gemini-3-pro-image-preview-11-2025","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kitchen Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #ffffff;
            color: #1e293b;
            -webkit-tap-highlight-color: transparent;
        }
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        .capsule-nav {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.15);
        }
        .check-circle {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .check-circle:active {
            transform: scale(0.9);
        }
        .fade-in-up {
            animation: fadeInUp 0.4s ease-out forwards;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .custom-checkbox:checked + div {
            background-color: #10b981;
            border-color: #10b981;
        }
        .custom-checkbox:checked + div svg {
            display: block;
        }
        
        /* Toast Animation */
        .toast-enter { opacity: 0; transform: translateY(20px) translateX(-50%); }
        .toast-enter-active { opacity: 1; transform: translateY(0) translateX(-50%); transition: all 0.3s ease-out; }
        .toast-exit { opacity: 1; transform: translateY(0) translateX(-50%); }
        .toast-exit-active { opacity: 0; transform: translateY(20px) translateX(-50%); transition: all 0.3s ease-in; }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:0px}.bottom-24{bottom:6rem}.bottom-8{bottom:2rem}.left-0{left:0px}.left-1\/2{left:50%}.right-4{right:1rem}.top-0{top:0px}.top-1\/2{top:50%}.z-10{z-index:10}.z-30{z-index:30}.z-40{z-index:40}.z-\[60\]{z-index:60}.z-\[70\]{z-index:70}.z-\[80\]{z-index:80}.z-\[90\]{z-index:90}.mx-auto{margin-left:auto;margin-right:auto}.-mt-8{margin-top:-2rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.ml-3{margin-left:0.75rem}.mt-0\.5{margin-top:0.125rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mb-1{margin-bottom:0.25rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-10{height:2.5rem}.h-14{height:3.5rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-7{height:1.75rem}.h-8{height:2rem}.h-1{height:0.25rem}.h-2{height:0.5rem}.min-h-screen{min-height:100vh}.w-10{width:2.5rem}.w-14{width:3.5rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-7{width:1.75rem}.w-8{width:2rem}.w-full{width:100%}.w-16{width:4rem}.w-2{width:0.5rem}.max-w-md{max-width:28rem}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.-translate-x-1\/2{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-\[-50\%\]{--tw-translate-x:-50%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-\[20px\]{--tw-translate-y:20px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-100{--tw-scale-x:1;--tw-scale-y:1;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}.cursor-pointer{cursor:pointer}.select-none{-webkit-user-select:none;user-select:none}.grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.items-baseline{align-items:baseline}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-1{gap:0.25rem}.gap-10{gap:2.5rem}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.space-y-10 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2.5rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.overflow-y-auto{overflow-y:auto}.whitespace-nowrap{white-space:nowrap}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-none{border-radius:0px}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-4{border-width:4px}.border-b{border-bottom-width:1px}.border-b-2{border-bottom-width:2px}.border-t{border-top-width:1px}.border-none{border-style:none}.border-slate-100{--tw-border-opacity:1;border-color:rgb(241 245 249 / var(--tw-border-opacity, 1))}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240 / var(--tw-border-opacity, 1))}.border-slate-300{--tw-border-opacity:1;border-color:rgb(203 213 225 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.border-white{--tw-border-opacity:1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.bg-emerald-50{--tw-bg-opacity:1;background-color:rgb(236 253 245 / var(--tw-bg-opacity, 1))}.bg-emerald-500{--tw-bg-opacity:1;background-color:rgb(16 185 129 / var(--tw-bg-opacity, 1))}.bg-slate-100{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.bg-slate-50{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.bg-slate-800{--tw-bg-opacity:1;background-color:rgb(30 41 59 / var(--tw-bg-opacity, 1))}.bg-slate-900\/20{background-color:rgb(15 23 42 / 0.2)}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/95{background-color:rgb(255 255 255 / 0.95)}.bg-slate-200{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.stroke-2{stroke-width:2}.stroke-\[1\.5\]{stroke-width:1.5}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-32{padding-top:8rem;padding-bottom:8rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-5{padding-top:1.25rem;padding-bottom:1.25rem}.py-24{padding-top:6rem;padding-bottom:6rem}.pb-32{padding-bottom:8rem}.pl-8{padding-left:2rem}.pt-4{padding-top:1rem}.pt-8{padding-top:2rem}.pt-2{padding-top:0.5rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-2xl{font-size:1.5rem;line-height:2rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-\[11px\]{font-size:11px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-light{font-weight:300}.font-medium{font-weight:500}.uppercase{text-transform:uppercase}.leading-tight{line-height:1.25}.tracking-wide{letter-spacing:0.025em}.tracking-wider{letter-spacing:0.05em}.tracking-widest{letter-spacing:0.1em}.text-emerald-400{--tw-text-opacity:1;color:rgb(52 211 153 / var(--tw-text-opacity, 1))}.text-emerald-600{--tw-text-opacity:1;color:rgb(5 150 105 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.underline{-webkit-text-decoration-line:underline;text-decoration-line:underline}.decoration-slate-300{-webkit-text-decoration-color:#cbd5e1;text-decoration-color:#cbd5e1}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.opacity-0{opacity:0}.opacity-50{opacity:0.5}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-emerald-200{--tw-shadow-color:#a7f3d0;--tw-shadow:var(--tw-shadow-colored)}.shadow-slate-200{--tw-shadow-color:#e2e8f0;--tw-shadow:var(--tw-shadow-colored)}.shadow-slate-400\/40{--tw-shadow-color:rgb(148 163 184 / 0.4);--tw-shadow:var(--tw-shadow-colored)}.outline-none{outline:2px solid transparent;outline-offset:2px}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-200{transition-duration:200ms}.duration-300{transition-duration:300ms}.placeholder\:text-slate-200::placeholder{--tw-text-opacity:1;color:rgb(226 232 240 / var(--tw-text-opacity, 1))}.placeholder\:text-slate-300::placeholder{--tw-text-opacity:1;color:rgb(203 213 225 / var(--tw-text-opacity, 1))}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:bg-emerald-100:hover{--tw-bg-opacity:1;background-color:rgb(209 250 229 / var(--tw-bg-opacity, 1))}.hover\:bg-emerald-600:hover{--tw-bg-opacity:1;background-color:rgb(5 150 105 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-100:hover{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-200:hover{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-50:hover{--tw-bg-opacity:1;background-color:rgb(248 250 252 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-700:hover{--tw-bg-opacity:1;background-color:rgb(51 65 85 / var(--tw-bg-opacity, 1))}.hover\:text-slate-600:hover{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.hover\:text-slate-800:hover{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.focus\:border-emerald-500:focus{--tw-border-opacity:1;border-color:rgb(16 185 129 / var(--tw-border-opacity, 1))}.focus\:border-slate-800:focus{--tw-border-opacity:1;border-color:rgb(30 41 59 / var(--tw-border-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-1:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-emerald-100:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(209 250 229 / var(--tw-ring-opacity, 1))}.focus\:ring-slate-200:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(226 232 240 / var(--tw-ring-opacity, 1))}.focus\:ring-slate-300:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(203 213 225 / var(--tw-ring-opacity, 1))}.active\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:scale-\[0\.98\]:active{--tw-scale-x:0.98;--tw-scale-y:0.98;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\:bg-slate-200:active{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}</style></head>
<body class="antialiased">

<div id="app" class="min-h-screen flex flex-col pb-32">
    <!-- Header -->
    <header class="sticky top-0 z-40 bg-white/95 backdrop-blur-sm px-5 py-2 flex items-center justify-between border-b border-slate-100 transition-all duration-300" id="main-header">
        <div class="select-none" onclick="handleTitleClick()" style="cursor: pointer;">
            <h1 class="text-sm font-bold tracking-widest text-slate-800 uppercase"></h1>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleDiscountCalc()" class="text-slate-500 hover:text-slate-800 transition-colors p-2 rounded-full hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="percent" class="lucide lucide-percent w-6 h-6 stroke-[1.5]"><line x1="19" x2="5" y1="5" y2="19"></line><circle cx="6.5" cy="6.5" r="2.5"></circle><circle cx="17.5" cy="17.5" r="2.5"></circle></svg>
            </button>
            <button onclick="toggleSettings()" class="text-slate-500 hover:text-slate-800 transition-colors p-2 rounded-full hover:bg-slate-50">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="settings-2" class="lucide lucide-settings-2 w-6 h-6 stroke-[1.5]"><path d="M14 17H5"></path><path d="M19 7h-9"></path><circle cx="17" cy="17" r="3"></circle><circle cx="7" cy="7" r="3"></circle></svg>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="flex-grow px-5 py-2">
                <div class="mb-2 pt-2 fade-in-up flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="layout-list" class="lucide lucide-layout-list w-6 h-6 text-slate-800"><rect width="7" height="7" x="3" y="3" rx="1"></rect><rect width="7" height="7" x="3" y="14" rx="1"></rect><path d="M14 4h7"></path><path d="M14 9h7"></path><path d="M14 15h7"></path><path d="M14 20h7"></path></svg>
                        <h2 class="text-2xl font-bold text-slate-800 tracking-widest"></h2>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                        <span class="text-xs font-mono text-slate-400 font-medium">2025/12/22</span>
                    </div>
                </div>
                
            <div class="py-24 text-center flex flex-col items-center opacity-50">
                <div class="w-16 h-1 bg-slate-200 rounded-full mb-6"></div>
                <p class="font-bold text-slate-600 text-lg mb-1"></p>
                <p class="text-sm text-slate-500"></p>
            </div>
        
            </main>

    <!-- Navigation -->
    <nav class="fixed bottom-8 left-1/2 -translate-x-1/2 z-30">
        <div class="capsule-nav rounded-full px-8 py-3 flex items-center gap-10">
            <button onclick="switchTab('foods')" id="tab-foods" class="group flex flex-col items-center gap-1 transition-colors text-emerald-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="layout-list" class="lucide lucide-layout-list w-6 h-6 stroke-[1.5]"><rect width="7" height="7" x="3" y="3" rx="1"></rect><rect width="7" height="7" x="3" y="14" rx="1"></rect><path d="M14 4h7"></path><path d="M14 9h7"></path><path d="M14 15h7"></path><path d="M14 20h7"></path></svg>
            </button>
            
            <button onclick="handlePlusButton()" class="w-14 h-14 bg-slate-800 text-white rounded-full flex items-center justify-center shadow-xl shadow-slate-400/40 hover:scale-105 active:scale-95 transition-transform duration-300 -mt-8 border-4 border-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="plus" class="lucide lucide-plus w-7 h-7 stroke-2"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
            </button>
            
            <button onclick="switchTab('memo')" id="tab-memo" class="group flex flex-col items-center gap-1 transition-colors text-slate-400 hover:text-slate-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="shopping-bag" class="lucide lucide-shopping-bag w-6 h-6 stroke-[1.5]"><path d="M16 10a4 4 0 0 1-8 0"></path><path d="M3.103 6.034h17.794"></path><path d="M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z"></path></svg>
            </button>
        </div>
    </nav>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-24 left-1/2 z-[90] bg-slate-800 text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-2 pointer-events-none opacity-0 transition-all duration-300 transform translate-x-[-50%] translate-y-[20px]">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check-circle" class="lucide lucide-check-circle w-5 h-5 text-emerald-400"><path d="M21.801 10A10 10 0 1 1 17 3.335"></path><path d="m9 11 3 3L22 4"></path></svg>
        <span id="toast-message" class="text-sm font-bold tracking-wide"></span>
    </div>

    <!-- Modals -->
    
    <!-- Action Select -->
    <div id="modal-action-select" class="fixed inset-0 z-[80] hidden bg-slate-900/20 backdrop-blur-sm flex items-center justify-center p-6">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 transform transition-all scale-100">
            <h3 id="action-title" class="text-lg font-bold text-slate-800 mb-2 tracking-wide"></h3>
            <p id="action-message" class="text-sm text-slate-600 mb-6 font-medium"></p>
            <div class="flex flex-col gap-3">
                <button id="action-move-btn" class="w-full py-3 rounded-xl bg-emerald-50 text-emerald-600 font-bold text-sm hover:bg-emerald-100 transition-colors flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-right-circle" class="lucide lucide-arrow-right-circle w-4 h-4"><circle cx="12" cy="12" r="10"></circle><path d="m12 16 4-4-4-4"></path><path d="M8 12h8"></path></svg> <span id="action-move-text"></span>
                </button>
                <button id="action-delete-btn" class="w-full py-3 rounded-xl bg-slate-800 text-white font-bold text-sm hover:bg-slate-700 transition-colors flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="trash-2" class="lucide lucide-trash-2 w-4 h-4"><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M3 6h18"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg> 
                </button>
                <button onclick="closeActionSelect()" class="w-full py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm hover:bg-slate-200 transition-colors mt-2">
                    
                </button>
            </div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="modal-confirm" class="fixed inset-0 z-[80] hidden bg-slate-900/20 backdrop-blur-sm flex items-center justify-center p-6">
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full p-6 transform transition-all scale-100">
            <h3 class="text-lg font-bold text-slate-800 mb-2 tracking-wide"></h3>
            <p id="confirm-message" class="text-sm text-slate-600 mb-6 font-medium"></p>
            <div class="flex gap-3">
                <button onclick="closeConfirm(false)" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-600 font-bold text-sm hover:bg-slate-200 transition-colors"></button>
                <button id="confirm-ok-btn" class="flex-1 py-3 rounded-xl bg-slate-800 text-white font-bold text-sm hover:bg-slate-700 transition-colors"></button>
            </div>
        </div>
    </div>
    
    <!-- Calculator -->
    <div id="modal-calc" class="fixed inset-0 z-[60] bg-white flex flex-col transition-opacity duration-200 hidden">
        <div class="flex items-center justify-between px-6 py-5 border-b border-slate-100 bg-white sticky top-0">
            <h3 class="font-bold text-slate-800 text-lg tracking-wider"></h3>
            <button onclick="toggleDiscountCalc()" class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-500 hover:bg-slate-100 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button>
        </div>
        <div class="p-8 flex-grow overflow-y-auto">
            <div class="max-w-sm mx-auto space-y-8 mt-4">
                <div class="relative">
                    <span class="absolute left-0 top-1/2 -translate-y-1/2 text-slate-400 font-light text-2xl"></span>
                    <input type="number" id="calc-price" placeholder="1000" class="w-full bg-transparent border-b border-slate-200 p-2 pl-8 text-4xl font-light text-slate-800 focus:border-slate-800 focus:outline-none transition-colors placeholder:text-slate-200">
                    <p class="text-[11px] text-slate-500 mt-2 font-medium"></p>
                </div>
                <div>
                    <label class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-3 block"></label>
                    <div class="grid grid-cols-4 gap-3 mb-4">
                        <button onclick="setDiscount(10)" class="py-3 rounded-xl bg-slate-50 text-sm font-bold text-slate-600 border border-slate-100 active:bg-slate-200 transition-colors">10%</button>
                        <button onclick="setDiscount(20)" class="py-3 rounded-xl bg-slate-50 text-sm font-bold text-slate-600 border border-slate-100 active:bg-slate-200 transition-colors">20%</button>
                        <button onclick="setDiscount(30)" class="py-3 rounded-xl bg-slate-50 text-sm font-bold text-slate-600 border border-slate-100 active:bg-slate-200 transition-colors">30%</button>
                        <button onclick="setDiscount(50)" class="py-3 rounded-xl bg-slate-50 text-sm font-bold text-slate-600 border border-slate-100 active:bg-slate-200 transition-colors"></button>
                    </div>
                    <div class="relative">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm">%</span>
                        <input type="number" id="calc-percent" placeholder="0" class="w-full bg-slate-50 rounded-xl p-4 text-center text-xl font-medium focus:ring-1 focus:ring-slate-300 outline-none text-slate-800">
                    </div>
                </div>
                <div class="pt-8 border-t border-slate-100 mt-4">
                    <div class="flex justify-between items-baseline mb-2">
                        <span class="text-sm text-slate-600 font-medium"></span>
                        <span id="res-total" class="text-4xl font-bold text-emerald-600">0</span>
                    </div>
                    <div class="flex justify-end text-sm text-slate-500 font-medium" id="res-discount">: -0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Food Modal -->
    <div id="modal-food" class="fixed inset-0 z-[60] hidden bg-white flex flex-col">
        <div class="flex items-center justify-between px-6 py-5 border-b border-slate-100 bg-white sticky top-0 z-10">
            <h3 id="modal-food-title" class="text-lg font-bold text-slate-800 tracking-wider"></h3>
            <button onclick="tryCloseFoodModal()" class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-500 hover:bg-slate-100 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button>
        </div>
        
        <div class="flex-grow overflow-y-auto p-6 pb-32">
            <div id="form-food" class="space-y-8 max-w-md mx-auto mt-2">
                <input type="hidden" id="input-food-id">
                <div class="group">
                    <label class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 block"></label>
                    <input type="text" id="input-food-name" placeholder=": " class="w-full bg-transparent border-b-2 border-slate-200 py-3 text-xl text-slate-800 placeholder:text-slate-300 focus:border-emerald-500 outline-none transition-colors rounded-none">
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 block"> ()</label>
                        <input type="text" id="input-food-label" placeholder=", ..." class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-emerald-100 transition-all font-medium border border-transparent">
                    </div>
                    <div>
                        <label class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 block"></label>
                        <input type="date" id="input-food-date" class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-emerald-100 transition-all font-medium border border-transparent">
                    </div>
                </div>

                <div class="flex items-center gap-3 py-2">
                    <label class="relative flex items-center cursor-pointer">
                        <input type="checkbox" id="input-food-limit" class="custom-checkbox sr-only">
                        <div class="w-6 h-6 border-2 border-slate-300 rounded-lg flex items-center justify-center transition-colors">
                            <svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <span class="ml-3 text-sm font-bold text-slate-700"></span>
                    </label>
                </div>
                
                <div class="pt-4">
                    <button onclick="saveFood()" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg shadow-slate-200 active:scale-[0.98] transition-all flex items-center justify-center gap-2 tracking-wide">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check w-5 h-5"><path d="M20 6 9 17l-5-5"></path></svg> <span id="btn-save-food-text"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Memo Modal -->
    <div id="modal-memo" class="fixed inset-0 z-[60] hidden bg-white flex flex-col">
        <div class="flex items-center justify-between px-6 py-5 border-b border-slate-100 bg-white sticky top-0 z-10">
            <h3 id="modal-memo-title" class="text-lg font-bold text-slate-800 tracking-wider"></h3>
            <button onclick="tryCloseMemoModal()" class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-500 hover:bg-slate-100 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button>
        </div>
        
        <div class="flex-grow overflow-y-auto p-6 pb-32">
            <div id="form-memo" class="space-y-8 max-w-md mx-auto mt-2">
                <input type="hidden" id="input-memo-id">
                <input type="hidden" id="input-memo-delete-on-save">
                
                <div class="group">
                    <label class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 block"></label>
                    <input type="text" id="input-memo-text" placeholder=": " class="w-full bg-transparent border-b-2 border-slate-200 py-3 text-xl text-slate-800 placeholder:text-slate-300 focus:border-emerald-500 outline-none transition-colors rounded-none">
                </div>

                <div class="group">
                    <label class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-2 block"> ()</label>
                    <input type="text" id="input-memo-label" placeholder=", 100..." class="w-full bg-slate-50 rounded-xl p-3 text-slate-700 outline-none focus:ring-2 focus:ring-emerald-100 transition-all font-medium border border-transparent">
                </div>

                <div class="flex items-center gap-3 py-2">
                    <label class="relative flex items-center cursor-pointer">
                        <input type="checkbox" id="input-memo-private-check" class="custom-checkbox sr-only">
                        <div class="w-6 h-6 border-2 border-slate-300 rounded-lg flex items-center justify-center transition-colors">
                            <svg class="w-4 h-4 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <span class="ml-3 text-sm font-bold text-slate-700"></span>
                    </label>
                </div>
                
                <div class="pt-4">
                    <button onclick="saveMemo()" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg shadow-slate-200 active:scale-[0.98] transition-all flex items-center justify-center gap-2 tracking-wide">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="check" class="lucide lucide-check w-5 h-5"><path d="M20 6 9 17l-5-5"></path></svg> <span id="btn-save-memo-text"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="modal-settings" class="fixed inset-0 z-[70] hidden bg-white flex flex-col">
        <div class="flex items-center justify-between px-6 py-5 border-b border-slate-100 bg-white sticky top-0">
            <h2 class="text-lg font-bold text-slate-800 tracking-wider"></h2>
            <button onclick="toggleSettings()" class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-500 hover:bg-slate-100 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-6 h-6"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button>
        </div>
        
        <div class="p-6 overflow-y-auto max-w-md mx-auto w-full space-y-10">
            <section>
                <h3 class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-4">ID</h3>
                <div class="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-slate-700 shadow-sm border border-slate-100">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="home" class="lucide lucide-home w-5 h-5 stroke-[1.5]"><path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"></path><path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>
                        </div>
                        <div>
                            <div class="text-sm font-bold text-slate-700"></div>
                            <div class="text-[11px] text-slate-500 leading-tight mt-0.5">ID</div>
                        </div>
                    </div>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="input-sync-id" class="flex-grow bg-white border border-slate-200 rounded-xl px-4 py-3 font-mono font-medium text-slate-700 focus:outline-none text-center tracking-widest" readonly="">
                        <button onclick="copyID()" class="bg-slate-800 text-white px-5 rounded-xl font-bold text-xs hover:bg-slate-700 transition-colors whitespace-nowrap"></button>
                    </div>
                    <button onclick="shareID()" class="w-full py-3 rounded-xl bg-emerald-500 text-white font-bold text-sm hover:bg-emerald-600 transition-colors flex items-center justify-center gap-2 mb-4 shadow-sm shadow-emerald-200">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="share-2" class="lucide lucide-share-2 w-4 h-4"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"></line><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"></line></svg> ID
                    </button>
                    <div class="mt-4 text-center">
                        <button onclick="reissueID()" class="text-[11px] text-slate-400 hover:text-slate-600 underline decoration-slate-300 font-medium">ID</button>
                    </div>
                </div>
            </section>

            <section>
                <h3 class="text-[11px] font-bold text-slate-500 uppercase tracking-widest mb-4">ID</h3>
                <div class="flex gap-2">
                    <input type="text" id="input-join-id" placeholder="ID" class="flex-grow bg-slate-50 border-none rounded-xl px-4 py-4 font-mono text-sm focus:ring-2 focus:ring-slate-200 outline-none transition-all text-slate-800 tracking-widest">
                    <button onclick="joinHousehold()" class="bg-white border border-slate-200 text-slate-800 px-6 rounded-xl font-bold text-sm hover:bg-slate-50 transition-colors"></button>
                </div>
            </section>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, deleteDoc, onSnapshot, query, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC8tXHR7rppmdXJK2kJoa2eQld7P_wpfIY",
      authDomain: "mottainai-d74e1.firebaseapp.com",
      projectId: "mottainai-d74e1",
      storageBucket: "mottainai-d74e1.firebasestorage.app",
      messagingSenderId: "1003487438420",
      appId: "1:1003487438420:web:1dd4851c82c5db2d292fc1"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = 'mottainai-app';

    // State
    let user = null;
    let householdId = localStorage.getItem('km_household_id');
    let currentTab = 'foods';
    let foods = [];
    let memos = [];
    let initialFormData = null;

    // Initialize Auth
    const initAuth = async () => {
        // Firebase
        await signInAnonymously(auth);
    };

    onAuthStateChanged(auth, (u) => {
        user = u;
        if (user) {
            if (!householdId) {
                householdId = user.uid.substring(0, 8).toUpperCase();
                localStorage.setItem('km_household_id', householdId);
            }
            document.getElementById('input-sync-id').value = householdId;
            startSync();
        }
    });

    initAuth();

    // Firestore Sync
    function startSync() {
        if (!user || !householdId) return;

        const foodsRef = collection(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_foods`);
        onSnapshot(foodsRef, (snapshot) => {
            foods = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            foods.sort((a, b) => new Date(a.expiry) - new Date(b.expiry));
            renderView();
        });

        const sharedMemosRef = collection(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_memos`);
        onSnapshot(sharedMemosRef, (snapshot) => {
            updateMemos(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), isPrivate: false })));
        });

        const privateMemosRef = collection(db, 'artifacts', appId, 'users', user.uid, 'memos');
        onSnapshot(privateMemosRef, (snapshot) => {
            updateMemos(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), isPrivate: true })));
        });
    }

    function updateMemos(newMemos) {
        // Just merge logic
        const otherType = newMemos[0]?.isPrivate ? memos.filter(m => !m.isPrivate) : memos.filter(m => m.isPrivate);
        memos = [...otherType, ...newMemos];
        memos.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
        renderView();
    }

    // Navigation
    const switchTab = (tab) => {
        currentTab = tab;
        const btnFoods = document.getElementById('tab-foods');
        const btnMemo = document.getElementById('tab-memo');
        const headerIcon = document.getElementById('header-icon');
        
        if (tab === 'foods') {
            btnFoods.className = "group flex flex-col items-center gap-1 transition-colors text-emerald-600";
            btnMemo.className = "group flex flex-col items-center gap-1 transition-colors text-slate-400 hover:text-slate-600";
            headerIcon.setAttribute('data-lucide', 'layout-list');
        } else {
            btnFoods.className = "group flex flex-col items-center gap-1 transition-colors text-slate-400 hover:text-slate-600";
            btnMemo.className = "group flex flex-col items-center gap-1 transition-colors text-emerald-600";
            headerIcon.setAttribute('data-lucide', 'shopping-bag');
        }
        renderView();
    };
    window.switchTab = switchTab;

    // Toast
    let toastTimer = null;
    const showToast = (msg) => {
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toast-message');
        toastMsg.innerText = msg;
        
        toast.classList.remove('opacity-0', 'translate-y-[20px]');
        toast.classList.add('opacity-100', 'translate-y-0');
        
        if (toastTimer) clearTimeout(toastTimer);
        toastTimer = setTimeout(() => {
            toast.classList.remove('opacity-100', 'translate-y-0');
            toast.classList.add('opacity-0', 'translate-y-[20px]');
        }, 3000);
    };

    // Helper
    const formatDate = (timestamp) => {
        if (!timestamp) return '';
        const d = new Date(timestamp.seconds * 1000);
        return `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
    };

    const getTodayString = () => {
        const d = new Date();
        return `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()}`;
    };

    const getDaysDiff = (expiryStr) => {
        const d = new Date(expiryStr);
        const expiry = new Date(d.getFullYear(), d.getMonth(), d.getDate());
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        return Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
    };

    // Rendering
    const renderView = () => {
        const container = document.getElementById('main-content');
        const todayStr = getTodayString();
        
        if (currentTab === 'foods') {
            container.innerHTML = `
                <div class="mb-2 pt-2 fade-in-up flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i data-lucide="layout-list" class="w-6 h-6 text-slate-800"></i>
                        <h2 class="text-2xl font-bold text-slate-800 tracking-widest"></h2>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                        <span class="text-xs font-mono text-slate-400 font-medium">${todayStr}</span>
                    </div>
                </div>
                ${foods.length === 0 ? renderEmptyState('', '') : `
                    <div class="space-y-0 pb-20 fade-in-up">
                        ${foods.map(food => renderFoodItem(food)).join('')}
                    </div>
                `}
            `;
        } else {
            container.innerHTML = `
                <div class="mb-4 pt-2 fade-in-up flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <i data-lucide="shopping-bag" class="w-6 h-6 text-slate-800"></i>
                        <h2 class="text-2xl font-bold text-slate-800 tracking-widest"></h2>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                        <span class="text-xs font-mono text-slate-400 font-medium">${todayStr}</span>
                    </div>
                </div>

                ${memos.length === 0 ? renderEmptyState('', '') : `
                    <div class="space-y-0 pb-20 fade-in-up">
                        ${memos.map(memo => renderMemoItem(memo)).join('')}
                    </div>
                `}
            `;
        }
        lucide.createIcons();
    };

    const renderEmptyState = (title, sub) => {
        return `
            <div class="py-24 text-center flex flex-col items-center opacity-50">
                <div class="w-16 h-1 bg-slate-200 rounded-full mb-6"></div>
                <p class="font-bold text-slate-600 text-lg mb-1">${title}</p>
                <p class="text-sm text-slate-500">${sub}</p>
            </div>
        `;
    };

    const renderFoodItem = (food) => {
        const diffDays = getDaysDiff(food.expiry);
        const isLimit = food.isConsumptionLimit || false; 
        
        let dateClass = "text-slate-400 font-medium"; 
        let dateText = "";
        let iconBgColor = "bg-slate-100";
        let iconColor = "text-slate-400";
        let expiryLabel = isLimit ? "" : "";
        let labelColorClass = isLimit ? "text-rose-400 font-bold" : "text-slate-400 font-medium";

        if (diffDays < 0) {
            dateClass = "text-rose-600 font-bold";
            dateText = `${Math.abs(diffDays)} `;
            iconBgColor = "bg-rose-100";
            iconColor = "text-rose-500";
        } else if (diffDays === 0) {
            dateClass = "text-rose-600 font-bold";
            dateText = "";
            iconBgColor = "bg-rose-100";
            iconColor = "text-rose-500";
        } else if (diffDays <= 3) {
            dateClass = "text-orange-500 font-bold";
            iconBgColor = "bg-orange-100";
            iconColor = "text-orange-500";
            dateText = ` ${diffDays} `;
        } else {
            const d = new Date(food.expiry);
            dateText = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
            
            if (diffDays <= 7) {
                iconBgColor = "bg-emerald-100";
                iconColor = "text-emerald-500";
            } else {
                iconBgColor = "bg-sky-100";
                iconColor = "text-sky-500";
            }
        }

        const labelBadge = food.label ? 
            `<span class="text-[11px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded-md font-medium ml-2 tracking-wide">${food.label}</span>` : '';
        
        return `
            <div class="group flex items-center py-4 px-1 gap-4 border-b border-slate-100 relative overflow-hidden cursor-pointer" onclick="openFoodModal('${food.id}')">
                <div class="w-10 h-10 rounded-full ${iconBgColor} flex items-center justify-center ${iconColor} flex-shrink-0">
                    <i data-lucide="utensils" class="w-4 h-4 stroke-[1.5]"></i>
                </div>
                <div class="flex-grow flex flex-col min-w-0">
                    <div class="flex items-center mb-0.5">
                        <h3 class="text-base font-bold text-slate-700 leading-tight">${food.name}</h3>
                        ${labelBadge}
                    </div>
                    <div class="flex items-center mt-1">
                        <span class="text-[11px] ${labelColorClass} mr-2">${expiryLabel}</span>
                        <span class="text-[11px] ${dateClass}">${dateText}</span>
                    </div>
                </div>
                <button onclick="event.stopPropagation(); openFoodAction('${food.id}', '${food.name}')" class="check-circle w-11 h-11 rounded-full border border-slate-400 flex items-center justify-center text-slate-500 hover:border-slate-800 hover:text-slate-800 transition-colors bg-white z-10 flex-shrink-0">
                    <i data-lucide="check" class="w-5 h-5"></i>
                </button>
            </div>
        `;
    };

    const renderMemoItem = (memo) => {
        const labelBadge = memo.label ? 
            `<span class="text-[11px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded-md font-medium ml-2 flex-shrink-0 tracking-wide">${memo.label}</span>` : '';
        
        const iconType = memo.isPrivate ? 'lock' : 'users';
        const iconBg = memo.isPrivate ? 'bg-slate-700' : 'bg-slate-50';
        const iconColor = memo.isPrivate ? 'text-white' : 'text-slate-400';
        const createdDate = formatDate(memo.createdAt);

        return `
            <div class="group flex items-center gap-4 py-4 px-1 border-b border-slate-100 last:border-0 cursor-pointer" onclick="openMemoModal('${memo.id}', ${memo.isPrivate})">
                <div class="w-10 h-10 rounded-full ${iconBg} flex items-center justify-center ${iconColor} flex-shrink-0">
                    <i data-lucide="${iconType}" class="w-4 h-4"></i>
                </div>
                <div class="flex-grow flex flex-col min-w-0">
                    <div class="flex items-center">
                        <span class="text-base font-medium ${memo.isPrivate ? 'text-slate-600' : 'text-slate-800'} break-words leading-snug">${memo.text}</span>
                        ${labelBadge}
                    </div>
                    ${createdDate ? `<span class="text-[11px] text-slate-400 mt-0.5">${createdDate}</span>` : ''}
                </div>
                <button onclick="event.stopPropagation(); openMemoAction('${memo.id}', ${memo.isPrivate}, '${memo.text}')" class="check-circle w-10 h-10 rounded-full border border-slate-400 hover:border-slate-800 flex items-center justify-center transition-all bg-white flex-shrink-0 text-slate-500 hover:text-slate-800">
                   <i data-lucide="check" class="w-5 h-5"></i>
                </button>
            </div>
        `;
    };

    // UI & Modal Control Variables
    const closeActionSelect = () => {
        document.getElementById('modal-action-select').classList.add('hidden');
        currentActionItem = null;
    };
    window.closeActionSelect = closeActionSelect;

    const closeFoodModal = () => document.getElementById('modal-food').classList.add('hidden');
    window.closeFoodModal = closeFoodModal;

    const closeMemoModal = () => document.getElementById('modal-memo').classList.add('hidden');
    window.closeMemoModal = closeMemoModal;

    const closeConfirm = () => {
        document.getElementById('modal-confirm').classList.add('hidden');
        onConfirmAction = null;
    };
    window.closeConfirm = closeConfirm;

    let currentActionItem = null;
    let onConfirmAction = null;

    // --- Exposed Functions to Window (for HTML onclick) ---

    window.openFoodAction = (id, name) => {
        currentActionItem = { type: 'food', id: id, name: name };
        document.getElementById('action-title').innerText = "";
        document.getElementById('action-message').innerText = name;
        document.getElementById('action-move-text').innerText = "";
        
        const moveBtn = document.getElementById('action-move-btn');
        const delBtn = document.getElementById('action-delete-btn');
        
        moveBtn.onclick = () => { closeActionSelect(); executeFoodMove(id, name); };
        delBtn.onclick = () => { closeActionSelect(); deleteFood(id); };
        
        document.getElementById('modal-action-select').classList.remove('hidden');
    };

    window.openMemoAction = (id, isPrivate, text) => {
        currentActionItem = { type: 'memo', id: id, isPrivate: isPrivate, text: text };
        document.getElementById('action-title').innerText = "";
        document.getElementById('action-message').innerText = text;
        document.getElementById('action-move-text').innerText = "";
        
        const moveBtn = document.getElementById('action-move-btn');
        const delBtn = document.getElementById('action-delete-btn');
        
        moveBtn.onclick = () => { closeActionSelect(); executeMemoMove(id, isPrivate, text); };
        delBtn.onclick = () => { closeActionSelect(); deleteMemo(id, isPrivate); };
        
        document.getElementById('modal-action-select').classList.remove('hidden');
    };

    window.showConfirm = (message, action) => {
        document.getElementById('confirm-message').innerText = message;
        document.getElementById('modal-confirm').classList.remove('hidden');
        onConfirmAction = action;
        const okBtn = document.getElementById('confirm-ok-btn');
        okBtn.onclick = () => {
            if (onConfirmAction) onConfirmAction();
            closeConfirm();
        };
    };

    const executeFoodMove = async (id, name) => {
        const sharedMemosRef = collection(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_memos`);
        await addDoc(sharedMemosRef, { text: name, createdAt: serverTimestamp() });
        await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_foods`, id));
        showToast("");
    };

    const executeMemoMove = (id, isPrivate, text) => {
        window.openFoodModal(null, text);
        document.getElementById('input-memo-delete-on-save').value = JSON.stringify({ id, isPrivate });
    };

    const saveFood = async () => {
        const id = document.getElementById('input-food-id').value;
        const name = document.getElementById('input-food-name').value;
        const expiry = document.getElementById('input-food-date').value;
        const label = document.getElementById('input-food-label').value;
        const isLimit = document.getElementById('input-food-limit').checked;
        const deleteMemoData = document.getElementById('input-memo-delete-on-save').value;

        if (!name || !expiry) return;

        const foodsRef = collection(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_foods`);
        
        if (id) {
            await updateDoc(doc(foodsRef, id), { name, expiry, label, isConsumptionLimit: isLimit });
        } else {
            await addDoc(foodsRef, { name, expiry, label, isConsumptionLimit: isLimit, createdAt: serverTimestamp() });
        }

        if (deleteMemoData) {
            try {
                const { id: memoId, isPrivate } = JSON.parse(deleteMemoData);
                if (isPrivate) {
                    await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'memos', memoId));
                } else {
                    await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_memos`, memoId));
                }
                showToast("");
            } catch (e) { console.error(e); }
        } else {
            showToast("");
        }
        closeFoodModal();
    };
    window.saveFood = saveFood;

    const deleteFood = (id) => {
        const foodsRef = doc(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_foods`, id);
        deleteDoc(foodsRef);
        showToast("");
    };

    const saveMemo = async () => {
        const id = document.getElementById('input-memo-id').value;
        const isPrivate = document.getElementById('input-memo-private-check').checked; 
        const text = document.getElementById('input-memo-text').value;
        const label = document.getElementById('input-memo-label').value;

        if (!text) return;

        let ref;
        if (isPrivate) {
            ref = collection(db, 'artifacts', appId, 'users', user.uid, 'memos');
        } else {
            ref = collection(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_memos`);
        }

        if (id) {
            await updateDoc(doc(ref, id), { text, label });
        } else {
            await addDoc(ref, { text, label, createdAt: serverTimestamp() });
        }
        showToast("");
        closeMemoModal();
    };
    window.saveMemo = saveMemo;

    const deleteMemo = (id, isPrivate) => {
        if (isPrivate) {
            deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'memos', id));
        } else {
            deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', `h_${householdId}_memos`, id));
        }
        showToast("");
    };

    const getFoodFormData = () => {
        return {
            name: document.getElementById('input-food-name').value,
            label: document.getElementById('input-food-label').value,
            date: document.getElementById('input-food-date').value,
            limit: document.getElementById('input-food-limit').checked
        };
    };

    window.openFoodModal = (id = null, prefillName = null) => {
        const modal = document.getElementById('modal-food');
        const title = document.getElementById('modal-food-title');
        const btnText = document.getElementById('btn-save-food-text');
        
        document.getElementById('input-memo-delete-on-save').value = '';

        if (id) {
            const food = foods.find(f => f.id === id);
            if (!food) return;
            document.getElementById('input-food-id').value = id;
            document.getElementById('input-food-name').value = food.name;
            document.getElementById('input-food-date').value = food.expiry;
            document.getElementById('input-food-label').value = food.label || '';
            document.getElementById('input-food-limit').checked = food.isConsumptionLimit || false;
            title.innerText = "";
            btnText.innerText = "";
        } else {
            document.getElementById('input-food-id').value = '';
            document.getElementById('input-food-name').value = prefillName || '';
            const d = new Date();
            d.setDate(d.getDate() + 3);
            document.getElementById('input-food-date').value = d.toISOString().split('T')[0];
            document.getElementById('input-food-label').value = '';
            document.getElementById('input-food-limit').checked = false;
            title.innerText = "";
            btnText.innerText = "";
        }
        
        modal.classList.remove('hidden');
        initialFormData = getFoodFormData();
        if(!id) document.getElementById('input-food-name').focus();
    };

    window.tryCloseFoodModal = () => {
        const currentData = getFoodFormData();
        if (JSON.stringify(currentData) !== JSON.stringify(initialFormData)) {
            showConfirm("", () => {
                closeFoodModal();
            });
        } else {
            closeFoodModal();
        }
    };

    const getMemoFormData = () => {
        return {
            text: document.getElementById('input-memo-text').value,
            label: document.getElementById('input-memo-label').value,
            isPrivate: document.getElementById('input-memo-private-check').checked
        };
    };

    window.openMemoModal = (id = null, isPrivate = false) => {
        const modal = document.getElementById('modal-memo');
        const title = document.getElementById('modal-memo-title');
        const btnText = document.getElementById('btn-save-memo-text');
        
        document.getElementById('input-memo-private-check').checked = isPrivate;

        if (id) {
            const memo = memos.find(m => m.id === id);
            if (!memo) return;
            document.getElementById('input-memo-id').value = id;
            document.getElementById('input-memo-private-check').checked = memo.isPrivate; 
            document.getElementById('input-memo-text').value = memo.text;
            document.getElementById('input-memo-label').value = memo.label || '';
            title.innerText = "";
            btnText.innerText = "";
        } else {
            document.getElementById('input-memo-id').value = '';
            document.getElementById('input-memo-text').value = '';
            document.getElementById('input-memo-label').value = '';
            title.innerText = "";
            btnText.innerText = "";
        }

        modal.classList.remove('hidden');
        initialFormData = getMemoFormData();
        if(!id) document.getElementById('input-memo-text').focus();
    };

    window.tryCloseMemoModal = () => {
        const currentData = getMemoFormData();
        if (JSON.stringify(currentData) !== JSON.stringify(initialFormData)) {
            showConfirm("", () => {
                closeMemoModal();
            });
        } else {
            closeMemoModal();
        }
    };
    
    window.toggleDiscountCalc = () => {
        const m = document.getElementById('modal-calc');
        m.classList.toggle('hidden');
        if (!m.classList.contains('hidden')) {
            document.getElementById('calc-price').focus();
        }
    };

    window.toggleSettings = () => {
        document.getElementById('modal-settings').classList.toggle('hidden');
    };

    // Logic
    const calcPrice = document.getElementById('calc-price');
    const calcPercent = document.getElementById('calc-percent');
    const resDiscount = document.getElementById('res-discount');
    const resTotal = document.getElementById('res-total');

    function updateCalc() {
        const p = parseFloat(calcPrice.value) || 0;
        const pct = parseFloat(calcPercent.value) || 0;
        const discount = Math.floor(p * (pct / 100));
        const total = p - discount;
        resDiscount.innerText = `: -${discount.toLocaleString()}`;
        resTotal.innerText = `${total.toLocaleString()}`;
    }
    calcPrice.addEventListener('input', updateCalc);
    calcPercent.addEventListener('input', updateCalc);
    window.setDiscount = (val) => {
        calcPercent.value = val;
        updateCalc();
    };

    window.reissueID = () => {
        showConfirm("IDID", () => {
            const newId = Math.random().toString(36).substring(2, 10).toUpperCase();
            localStorage.setItem('km_household_id', newId);
            location.reload();
        });
    };

    window.joinHousehold = () => {
        const id = document.getElementById('input-join-id').value.trim().toUpperCase();
        if (id.length < 4) return;
        localStorage.setItem('km_household_id', id);
        location.reload();
    };

    // Triple Click Download
    let titleClickCount = 0;
    let titleClickTimer = null;
    window.handleTitleClick = () => {
        titleClickCount++;
        if (titleClickTimer) clearTimeout(titleClickTimer);
        titleClickTimer = setTimeout(() => { titleClickCount = 0; }, 500);
        
        if (titleClickCount === 3) {
            const link = document.createElement('a');
            const file = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
            link.href = URL.createObjectURL(file);
            link.download = 'kitchen-manager.html';
            link.click();
            titleClickCount = 0;
        }
    };

    window.handlePlusButton = () => {
        if (currentTab === 'foods') {
            window.openFoodModal(); 
        } else {
            window.openMemoModal(null, false);
        }
    };

    window.copyID = () => {
        const id = document.getElementById('input-sync-id').value;
        navigator.clipboard.writeText(id);
        const btn = document.querySelector('[onclick="copyID()"]');
        const originalText = btn.innerText;
        btn.innerText = "";
        setTimeout(() => btn.innerText = originalText, 2000);
    };

    window.shareID = async () => {
        const id = document.getElementById('input-sync-id').value;
        const shareData = {
            title: '',
            text: `ID\nID: ${id}`,
            url: window.location.href
        };

        try {
            if (navigator.share) {
                await navigator.share(shareData);
            } else {
                navigator.clipboard.writeText(`${shareData.text}\n${shareData.url}`);
                showToast("");
            }
        } catch (err) {
            console.error(err);
        }
    };
</script>


</body></html>